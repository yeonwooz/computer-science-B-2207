## 트랜잭션

하나의 논리적 기능을 수행하는 작업의 단위

여러 개의 쿼리를 하나로 묵는 단위

## 트랜잭션의 ACID특징

- 원자성 : 트랜잭션의 요소는 모두 수행되거나, 모두 수행되지 않는다.(all or nothing)

  - 커밋 : 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어. 하나의 트랜잭션이 완전히 성공하면 커밋으로 확정되어 저장된다.
  - 롤백 : 트랜잭션 수행을 위해 커밋이 시작된 이후 중간에 문제가 생겨 커밋을 취소하는 것. 시작된 커밋을 롤백하면 데이터는 커밋 시작 전으로 돌아가고 해당 커밋은 저장되지 않는다.
  - 트랜잭션 전파 : 여러 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 하는 것.

- 일관성 : 데이터는 조건과 규칙에 따라 허용된 방식으로만 변경해야 한다.

- 독립성 : 트랜잭션 수행은 서로 끼어들 수 없다. 복수의 트랜잭션은 서로 격리되고, 순차적 실행처럼 동작해서 데이터의 무결성을 지켜야 한다.

  - 단순 순차 실행은 성능이 나빠지므로 병렬처리를 위해 격리수준을 몇 단계로 나눈다. 위로 갈수록 동시성이 강해지고, 아래로 갈수록 격리성이 강해진다.

    - READ_UNCOMMITTED : 가장 낮은 격리 수준. 다른 트랜잭션이 변경했지만 아직 커밋하지 않은 정보도 읽을 수 있다. 무결성을 유지하기 어려울 수 있다. 만약 무결성을 엄격하게 관리하지 않고 많은 양의 데이터를 어림집계하려는 목적이라면 가장 좋은 성능이 예상된다.

    - READ_COMMITTED : 다른 트랜잭션이 변경했지만 아직 커밋하지 않은 정보는 읽을 수 없다. <br/>

      그러나 다른 트랜잭션이 데이터를 변경하지 않았고 조회만 한 상황이라면, 해당 데이터를 수정할 수 있다. 그러므로 이미 해당 데이터를 조회하던 트랜잭션은 다시 접근했을 때 데이터가 바뀌어 있을 수 있다.

    - REPEATABLE_READ : 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정하지 못하도록 격리. 그러나 새로운 행은 추가할 수 있다.

    - SERIALIZABLE : 매우 엄격한 격리. 트랜잭션을 순차적으로 진행시킨다. <br/>여러 트랜잭션이 동시에 같은 행에 접근할 수 없다. 교착상태가 일어날 확률이 많고 성능이 가장 낮은 격리수준이다.

  - 격리수준에 따른 현상
    - 팬텀리드 : 한 트랜잭션 내에서 동일한 쿼리를 보낼 때 해당 조회 결과가 다른 경우
    - 반복 가능하지 않은 조회 : 한 트랜잭션 내의 같은 행에 두번 이상 조회가 발생했는데, 그 값이 다른 경우. 팬텀리드와 달리, 행 자체의 값이 달라질 수 있다는 특징이 있다.
    - 더티 리드 : 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 데이터가 수정되었지만 아직 커밋되지는 않은 행의 데이터를 읽을 수 있는 경우에 발생한다.

- 지속성 : 성공적으로 수행된 트랜잭션은 영원히 반영되어야 한다.
  - 체크섬 : 오류 정정을 통해 송신된 자료의 무결성을 보호하는 중복검사.
  - 저널링 : 파일 시스템 또는 데이터베이스 시스템에 변경사항을 커밋하기 전에 로깅하는 것. 트랜잭션 등 변경사항에 대한 로그를 남기는 것.
